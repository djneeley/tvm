<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->  
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <link rel="stylesheet" href="styles.css">
    <script src="tvm.js"></script>
    
    <title>TVM</title>
  </head>
  <body>
    <div class="container">
        
    <div>
        <h1 class="display-4">
            Retirement Income Calculator
            <small class="text-muted">Advanced</small>
        </h1>
        <p>Use this calculator to estimate your income in retirement based on current accumulated savings, future monthly savings, and other assumptions.</p>
    </div>

    <div class="sticky-top bg-white pb-2">
        <div class="row">
            <div class="col-sm">
                <h4>Retirement Income</h4>
                <div class="row">
                    <div class="col-8">
                        <p class="lead">$<span id="retirementIncome">0</span></p>
                    </div>
                    <div class="col-4 text-center">
                        <label class="switch">
                          <input type="checkbox">
                          <span class="knob round"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-sm">
                <h4>Savings at Retirement</h4>
                <div class="row">
                    <div class="col-8">
                        <p class="lead">$<span id="retirementIncome">0</span></p>
                    </div>
                    <div class="col-4 text-center">
                        <label class="switch">
                          <input type="checkbox">
                          <span class="knob round"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="col-sm">
                <h4>Death Benefit</h4>
                <div class="row">
                    <div class="col-8">
                        <p class="lead">$<span id="retirementIncome">0</span></p>
                    </div>
                    <div class="col-4 text-center">
                        <label class="switch">
                          <input type="checkbox">
                          <span class="knob round"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="mb-4">
    <h6>Withdrawal Method</h6>
    <div class="btn-group btn-group-toggle" data-toggle="buttons">
      <label class="btn btn-secondary active">
        <input type="radio" name="methods" id="option1" autocomplete="off" checked> Annuity
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="methods" id="option2" autocomplete="off"> Fixed $
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="methods" id="option3" autocomplete="off"> Fixed %
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="methods" id="option4" autocomplete="off"> Preserve Capital
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="methods" id="option5" autocomplete="off"> Perpetuity
      </label>
      <label class="btn btn-secondary">
        <input type="radio" name="methods" id="option6" autocomplete="off"> No Income
      </label>
    </div>
    </div>
    <div class="row">
        <div class="col-md mb-4">
            <h6>Current Savings</h6>
            <p class="lead">$<span id="currentSavingsLabel">10,000</span></p>
            <div class="slidecontainer">
                <input type="range" id="currentSavings" min="0" max="2000000" step="1000" value="10000" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md mb-4">
            <h6>Monthly Savings</h6>
            <p class="lead">$<span id="monthlySavingsLabel">1000</span> per month</p>
            <div class="slidecontainer">
                <input type="range" id="monthlySavings" min="0" max="10000" step="50"  value="1000" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md mb-4">
            <h6>Savings Increase</h6>
            <p class="lead"><span id="savingsIncreaseLabel">3</span>% per year</p>
            <div class="slidecontainer">
                <input type="range" id="savingsIncrease" min="0" max="10" step="0.1" value="3" oninput="updateResult()" class="slider">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 mb-4">
            <h6>Return Before Retirement</h6>
            <p class="lead"><span id="preRetirementReturnLabel">8</span>% per year</p>
            <div class="slidecontainer">
                <input type="range" id="preRetirementReturn" min="0" max="12" step="0.1" value="8" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <h6>Return During Retirement</h6>
            <p class="lead"><span id="postRetirementReturnLabel">8</span>% per year</p>
            <div class="slidecontainer">
                <input type="range" id="postRetirementReturn" min="0" max="12" step="0.1" value="8" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <h6>Inflation Rate</h6>
            <p class="lead"><span id="inflationRateLabel">3</span>% per year</p>
            <div class="slidecontainer">
                <input type="range" id="inflationRate" min="0" max="5" step="0.1" value="3" oninput="updateResult()" class="slider">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 mb-4">
            <h6>Years to Retirement</h6>
            <p class="lead"><span id="yearsToRetirementLabel">30</span> years</p>
            <div class="slidecontainer">
                <input type="range" id="yearsToRetirement" min="0" max="50" step="1" value="30" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <h6>Years in Retirement</h6>
            <p class="lead"><span id="yearsInRetirementLabel">40</span> years</p>
            <div class="slidecontainer">
                <input type="range" id="yearsInRetirement" min="1" max="50" step="1" value="40" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md mb-4">
            <h6>Value at Death</h6>
            <div class="row">
                <div class="col-8">
                    <p class="lead">$<span id="valueAtDeathLabel">0</span></p>
                </div>
                <div class="col-4 text-right">
                    <label class="switch">
                      <input type="checkbox">
                      <span class="knob round"></span>
                    </label>
                </div>
            </div>
            <div class="slidecontainer">
                <input type="range" id="valueAtDeath" min="0" max="2000000" step="1000" value="0" oninput="updateResult()" class="slider">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-4 mb-4">
            <h6>Fixed Dollar Rate</h6>
            <p class="lead"><span id="fixedDollarRateLabel">4</span>% per year</p>
            <div class="slidecontainer">
                <input type="range" id="fixedDollarRate" min="0" max="12" step="0.1" value="4" oninput="updateResult()" class="slider">
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <h6>Fixed Percentage Rate</h6>
            <p class="lead"><span id="fixedPercentageRateLabel">6</span>% per year</p>
            <div class="slidecontainer">
                <input type="range" id="fixedPercentageRate" min="0" max="12" step="0.1" value="6" oninput="updateResult()" class="slider">
            </div>
        </div>
    </div>

    <h2>Options</h2>
      <div class="onoffswitch">
        <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked onchange="updateResult()">
        <label class="onoffswitch-label" for="myonoffswitch">
          <span class="onoffswitch-inner"></span>
          <span class="onoffswitch-switch"></span>
        </label>
      </div>

    </div>

    <script language="javascript" type="text/javascript">
      updateResult();

      function updateResult()
      {
        var currentSavings = document.querySelector('#currentSavings');
        document.querySelector('#currentSavingsLabel').textContent = (Number(currentSavings.value)).formatMoney(0);
        var monthlySavings = document.querySelector('#monthlySavings');
        document.querySelector('#monthlySavingsLabel').textContent = (Number(monthlySavings.value)).formatMoney(0);
        var savingsIncrease = document.querySelector('#savingsIncrease');
        document.querySelector('#savingsIncreaseLabel').textContent = (Number(savingsIncrease.value)).formatMoney(1);
        var preRetirementReturn = document.querySelector('#preRetirementReturn');
        document.querySelector('#preRetirementReturnLabel').textContent = (Number(preRetirementReturn.value)).formatMoney(1);
        var postRetirementReturn = document.querySelector('#postRetirementReturn');
        document.querySelector('#postRetirementReturnLabel').textContent = (Number(postRetirementReturn.value)).formatMoney(1);
        var inflationRate = document.querySelector('#inflationRate');
        document.querySelector('#inflationRateLabel').textContent = (Number(inflationRate.value)).formatMoney(1);
        var yearsToRetirement = document.querySelector('#yearsToRetirement');
        document.querySelector('#yearsToRetirementLabel').textContent = yearsToRetirement.value;
        var yearsInRetirement = document.querySelector('#yearsInRetirement');
        document.querySelector('#yearsInRetirementLabel').textContent = yearsInRetirement.value;
        var valueAtDeath = document.querySelector('#valueAtDeath');
        document.querySelector('#valueAtDeathLabel').textContent = (Number(valueAtDeath.value)).formatMoney(0);
        var fixedDollarRate = document.querySelector('#fixedDollarRate');
        document.querySelector('#fixedDollarRateLabel').textContent = (Number(fixedDollarRate.value)).formatMoney(1);
        var fixedPercentageRate = document.querySelector('#fixedPercentageRate');
        document.querySelector('#fixedPercentageRateLabel').textContent = (Number(fixedPercentageRate.value)).formatMoney(1);
        var monthlyReturn = annualToMonthly(preRetirementReturn.value/100);
        var monthlySavingsIncrease = annualToMonthly(savingsIncrease.value/100);
        var savingsAtRetirement = FVPresentSum(currentSavings.value, yearsToRetirement.value*12,monthlyReturn) + FVGrowingAnnuity(monthlySavings.value, yearsToRetirement.value*12, monthlyReturn, monthlySavingsIncrease);
        var initialPayment = 0;
        if (document.getElementById('myonoffswitch').checked)
        {
            initialPayment = RIGrowingAnnuity(savingsAtRetirement,yearsInRetirement.value,postRetirementReturn.value/100,inflationRate.value/100);
        }
        else
        {
        	initialPayment = RIGrowingPerpetuity(savingsAtRetirement, postRetirementReturn.value/100, inflationRate.value/100);
        }

        var retirementIncome = (Math.round(PVFutureSum(initialPayment, yearsToRetirement.value, inflationRate.value/100)/1000)*1000).formatMoney(0);
        document.querySelector('#retirementIncome').textContent = retirementIncome;
        return True;
      }
    </script>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
      
  </body>
</html>
